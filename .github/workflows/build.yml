name: Build

on:
	push:
		branches: [master]
		paths-ignore:
		- "**.md"
		- "**.spec.js"
		- ".idea"
		- ".vscode"
		- ".dockerignore"
		- "Dockerfile"
		- ".gitignore"
		- ".github/**"
		- "!.github/workflows/build.yml"

jobs:
	build:
		runs-on: ${{ matrix.os }}
		if: contains(github.event.head_commit.message, '[RELEASE]')

		strategy:
		matrix:
			os: [macos-latest, windows-latest]

		steps:
			- name: Checkout Code
				uses: actions/checkout@ac593985615ec2ede58e132d2e21d2b1cbd6127c # v3
			
			- name: Setup pnpm
				uses: pnpm/action-setup@v2
				with:
					version: 7

			- name: Setup Node.js
				uses: actions/setup-node@64ed1c7eab4cce3362f8c340dee64e5eaeef8f7c # v3
				with:
				node-version: 18

			- name: Install Dependencies
				run: pnpm install --frozen-lockfile

			- name: Build Release Files
				run: pnpm run build
				env:
				GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

			- name: Upload Artifact
				uses: actions/upload-artifact@0b7f8abb1508181956e8e162db84b466c27e18ce # v3
				with:
				name: release_on_${{ matrix. os }}
				path: release/
				retention-days: 5
